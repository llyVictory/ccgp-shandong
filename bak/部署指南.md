# 🎯 便携版部署指南

## 📦 打包步骤（在开发电脑上）

### 1. 运行打包脚本

```bash
双击运行：打包便携版.bat
```

这将创建 `spider_portable` 文件夹，包含所有必要文件。

### 2. 复制到U盘

将整个 `spider_portable` 文件夹复制到U盘。

**建议**：压缩成ZIP方便传输

- 右键 `spider_portable` → 发送到 → 压缩文件夹
- 文件名：`山东政采爬虫_便携版.zip`

---

## 🚀 部署步骤（在目标电脑上）

### 方式A：从U盘直接运行

1. **插入U盘**
2. **进入文件夹**：`spider_portable`
3. **运行安装**：双击 `首次安装.bat`
4. **启动服务**：双击 `启动爬虫.bat`

⚠️ **限制**：U盘拔出后服务停止

---

### 方式B：复制到本地硬盘（推荐）

1. **复制文件夹**：

   ```
   从U盘复制 spider_portable 到：
   D:\Programs\spider_portable
   ```

2. **运行安装**：

   ```
   进入 D:\Programs\spider_portable
   双击 首次安装.bat
   等待3-5分钟完成依赖安装
   ```

3. **启动服务**：

   ```
   双击 启动爬虫.bat
   浏览器自动打开 http://localhost:8080
   ```

---

## 📋 目标电脑需求检查清单

| 检查项 | 要求 | 验证方法 |
|--------|------|----------|
| ✅ 操作系统 | Windows 10/11 (64位) | 右键"此电脑"→属性 |
| ✅ Python | 3.8+ | CMD输入：`python --version` |
| ✅ Chrome | 任意版本 | 打开Chrome→菜单→关于 |
| ✅ 网络 | 能访问互联网 | 打开浏览器测试 |
| ✅ 磁盘空间 | 至少500MB | 查看硬盘剩余空间 |

---

## 🔧 首次安装详细步骤

### 安装Python（如果还没有）

1. **下载Python**：
   - 访问：<https://www.python.org/downloads/>
   - 下载最新版本（推荐3.10或3.11）

2. **安装时注意**：
   - ✅ **必须勾选** "Add Python to PATH"
   - ✅ 推荐选择 "Install for all users"
   - ✅ 推荐自定义安装位置（如 C:\Python311）

3. **验证安装**：

   ```bash
   Win+R → 输入 cmd → 回车
   输入：python --version
   应该显示：Python 3.x.x
   ```

### 安装Chrome（如果还没有）

1. 访问：<https://www.google.com/chrome/>
2. 下载并安装

---

## 📖 使用流程

### 日常使用

```
1. 双击"启动爬虫.bat"
   ↓
2. 等待浏览器自动打开
   ↓
3. 在控制台进行操作
   - 立即执行：手动爬取
   - 定时任务：自动定时爬取
   ↓
4. 完成后关闭窗口或运行"停止服务.bat"
```

### 设置开机自启动（可选）

1. **创建快捷方式**：

   ```
   右键"启动爬虫.bat" → 创建快捷方式
   ```

2. **移动到启动文件夹**：

   ```
   Win+R → 输入：shell:startup → 回车
   把快捷方式复制到打开的文件夹
   ```

3. **设置无窗口启动**（可选）：
   - 右键快捷方式 → 属性
   - 运行方式：选择"最小化"

---

## ⚠️ 常见问题和解决

### Q1：提示"未检测到Python"

**原因**：Python未安装或未添加到PATH

**解决**：

```bash
1. 重新安装Python
2. 安装时务必勾选"Add Python to PATH"
3. 安装完成后重启电脑
4. 再次运行"首次安装.bat"
```

### Q2：依赖安装失败

**原因**：网络问题或pip版本过旧

**解决**：

```bash
1. 检查网络连接
2. 手动升级pip：
   .\venv\Scripts\activate
   python -m pip install --upgrade pip
3. 重新运行"首次安装.bat"
```

### Q3：浏览器打不开

**原因**：端口8080被占用

**解决**：

```bash
方法1：查找并关闭占用端口的程序
CMD输入：netstat -ano | findstr :8080

方法2：修改端口
打开 server.py
最后一行改为：port=8090
访问地址改为：http://localhost:8090
```

### Q4：Chrome自动化失败

**原因**：ChromeDriver版本不匹配

**解决**：

```bash
1. 删除缓存：
   删除文件夹：C:\Users\你的用户名\.cache\selenium

2. 重新运行程序，自动下载匹配版本
```

### Q5：定时任务不执行

**原因**：服务窗口被关闭

**解决**：

```bash
1. 保持"启动爬虫.bat"窗口开启
2. 可以最小化，但不要关闭
3. 或者设置为开机自启动
```

---

## 📊 文件结构说明

```
spider_portable/
├── 📄 启动爬虫.bat           # [日常使用] 启动脚本
├── 📄 首次安装.bat           # [首次运行] 初始化脚本
├── 📄 停止服务.bat           # [可选] 停止服务
├── 📄 使用说明.md            # [帮助] 完整使用手册
├── 📄 README_便携版.md       # [快速] 快速开始指南
│
├── 📄 server.py             # 后端服务主程序
├── 📄 requirements.txt      # Python依赖列表
│
├── 📁 spider/               # 爬虫核心代码
│   ├── shandong.py         # 山东爬虫逻辑
│   └── browser_engine.py   # 浏览器自动化引擎
│
├── 📁 static/               # Web前端界面
│   └── index.html          # 控制台页面
│
├── 📁 venv/                 # 虚拟环境（首次安装后生成）
├── 📁 downloads/            # 默认下载目录
└── 📄 schedule_config.json  # 定时任务配置（自动生成）
```

---

## 🎯 快速命令参考

### 基本操作

```bash
# 启动服务
双击：启动爬虫.bat

# 停止服务
双击：停止服务.bat
或按 Ctrl+C（在服务窗口）

# 重新安装依赖
双击：首次安装.bat
选择：删除重建
```

### 高级操作

```bash
# 手动激活虚拟环境
.\venv\Scripts\activate

# 查看已安装的包
pip list

# 更新依赖
pip install -r requirements.txt --upgrade

# 查看服务日志
# 方法：观察"启动爬虫.bat"窗口的输出
```

---

## 📞 技术支持

### 准备信息

遇到问题请提供：

1. 错误截图（包含完整错误信息）
2. Python版本：`python --version`
3. Chrome版本
4. 操作步骤描述

### 日志收集

```bash
# 服务日志
查看"启动爬虫.bat"窗口的输出

# 定时任务日志
查看服务窗口中以[定时任务]开头的日志
```

---

## 🔄 版本更新

### 更新到新版本

1. 下载新版本的 `spider_portable.zip`
2. 解压到新位置
3. 复制旧版本的 `schedule_config.json`（如果有）
4. 运行"首次安装.bat"
5. 启动使用

### 保留配置

需要保留的文件：

- `schedule_config.json` - 定时任务配置
- `downloads/` - 历史下载数据

---

## ✅ 部署验证清单

部署完成后请验证：

- [ ] Python可用：`python --version` 正常显示
- [ ] Chrome已安装且可打开
- [ ] "首次安装.bat"运行成功，venv文件夹已生成
- [ ] "启动爬虫.bat"运行成功，显示"Uvicorn running"
- [ ] 浏览器自动打开 <http://localhost:8080>
- [ ] 控制台界面正常显示
- [ ] 点击"立即执行一次"，Chrome自动打开
- [ ] 创建定时任务成功，状态正常显示

---

**祝部署顺利！** 🚀
